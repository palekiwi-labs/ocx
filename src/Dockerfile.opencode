ARG BASE_IMAGE=localhost/ocx-base:latest
FROM ${BASE_IMAGE}

ARG OPENCODE_VERSION=1.1.23
ARG USERNAME=user

USER root

# Download and install OpenCode (x86_64 only)
RUN curl -fsSL "https://github.com/anomalyco/opencode/releases/download/v${OPENCODE_VERSION}/opencode-linux-x64.tar.gz" \
  | tar -xz -C /usr/local/bin/ && \
  chmod +x /usr/local/bin/opencode

# Ensure /usr/local/bin is in PATH (defensive for custom base images)
ENV PATH="/usr/local/bin:${PATH}"

USER ${USERNAME}

CMD ["opencode"]
